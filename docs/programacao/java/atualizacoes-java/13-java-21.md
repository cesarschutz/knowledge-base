# 2️⃣1️⃣ Java 21 LTS (2023)

## 🚀 Java 21 - A LTS Revolucionária

Java 21 é a versão LTS mais avançada, trazendo Virtual Threads e outras inovações que transformam a programação concorrente em Java.

---

## ⭐ Principais Novidades

### 🔹 Virtual Threads (Final)

#### ❓ O que é?
Threads leves gerenciadas pela JVM que permitem milhões de threads concorrentes com baixo overhead.

#### 💡 Exemplo Simples
```java
// Criar Virtual Thread simples
Thread vThread = Thread.ofVirtual().start(() -> {
    System.out.println("Executando em Virtual Thread: " + 
        Thread.currentThread());
});

// Executor com Virtual Threads
try (var executor = Executors.newVirtualThreadPerTaskExecutor()) {
    // Pode criar milhões dessas sem problema!
    for (int i = 0; i < 100_000; i++) {
        executor.submit(() -> {
            try {
                Thread.sleep(1000); // Não bloqueia thread do SO
                System.out.println("Task " + Thread.currentThread());
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        });
    }
}
```

📚 **Saiba mais**: [Virtual Threads Guide](https://openjdk.org/jeps/444)

### 🔹 String Templates (Preview)

#### ❓ O que é?
Interpolação de strings type-safe que permite embedding de expressões diretamente na string.

#### 💡 Exemplo Simples
```java
// String Template básico
String name = "João";
int age = 30;
String message = STR."Olá, \{name}! Você tem \{age} anos.";
// Resultado: "Olá, João! Você tem 30 anos."

// Com expressões
double price = 19.99;
int quantity = 3;
String invoice = STR."Total: R$ \{price * quantity}";
// Resultado: "Total: R$ 59.97"

// JSON Template
String json = STR."""
    {
        "name": "\{name}",
        "age": \{age},
        "email": "\{name.toLowerCase()}@email.com"
    }
    """;
```

### 🔹 Pattern Matching for Switch (Final)

#### ❓ O que é?
Switch melhorado que suporta pattern matching com qualquer tipo e guards.

#### 💡 Exemplo Simples
```java
// Pattern matching com tipos
public String processValue(Object value) {
    return switch (value) {
        case String s when s.length() > 10 -> "String longa: " + s;
        case String s -> "String curta: " + s;
        case Integer i when i > 0 -> "Número positivo: " + i;
        case Integer i -> "Número não positivo: " + i;
        case null -> "Valor nulo";
        default -> "Tipo desconhecido: " + value.getClass();
    };
}

// Com Records
record Point(int x, int y) {}
record Circle(Point center, int radius) {}

public String analyzeShape(Object shape) {
    return switch (shape) {
        case Circle(Point(int x, int y), int r) when r > 10 -> 
            STR."Círculo grande em (\{x}, \{y}) com raio \{r}";
        case Circle(Point(int x, int y), int r) -> 
            STR."Círculo pequeno em (\{x}, \{y}) com raio \{r}";
        case Point(int x, int y) -> STR."Ponto em (\{x}, \{y})";
        default -> "Forma desconhecida";
    };
}
```

### 🔹 Sequenced Collections

#### ❓ O que é?
Nova interface que representa coleções com ordem definida, oferecendo acesso ao primeiro e último elemento.

#### 💡 Exemplo Simples
```java
// SequencedCollection interface
List<String> list = List.of("primeiro", "meio", "último");

// Métodos novos
String primeiro = list.getFirst();  // "primeiro"
String ultimo = list.getLast();     // "último"

// Reversed view
List<String> reverso = list.reversed();
// ["último", "meio", "primeiro"]

// Com Set também
LinkedHashSet<String> set = new LinkedHashSet<>();
set.add("a");
set.add("b");
set.add("c");

String primeiroSet = set.getFirst(); // "a"
String ultimoSet = set.getLast();    // "c"
```

### 🔹 Record Patterns (Final)

#### ❓ O que é?
Permite desestruturar Records diretamente em pattern matching.

#### 💡 Exemplo Simples
```java
record Person(String name, int age) {}
record Employee(Person person, String department) {}

public String processEmployee(Employee emp) {
    return switch (emp) {
        // Desestruturação aninhada
        case Employee(Person(String name, int age), String dept) 
            when age < 25 -> STR."\{name} é estagiário em \{dept}";
        case Employee(Person(String name, int age), String dept) 
            when age > 50 -> STR."\{name} é sênior em \{dept}";
        case Employee(Person(String name, int age), String dept) -> 
            STR."\{name} (\{age} anos) trabalha em \{dept}";
    };
}
```

### 🔹 Key Encapsulation Mechanism API

#### ❓ O que é?
API para algoritmos criptográficos quantum-safe, preparando Java para a era pós-quântica.

#### 💡 Exemplo Simples
```java
// Gerar par de chaves para KEM
KeyPairGenerator kpg = KeyPairGenerator.getInstance("ML-KEM");
KeyPair keyPair = kpg.generateKeyPair();

// Encapsular segredo
KEM kem = KEM.getInstance("ML-KEM");
KEM.Encapsulator encapsulator = kem.newEncapsulator(keyPair.getPublic());
KEM.Encapsulated encapsulated = encapsulator.encapsulate();

byte[] sharedSecret = encapsulated.key();
byte[] encapsulation = encapsulated.encapsulation();
```

---

## 🔧 Outras Melhorias Importantes

### ⚡ Performance
- **Generational ZGC**: Garbage Collection ainda mais eficiente
- **Prepare to Restrict Dynamic Loading**: Melhor segurança
- **Dynamic CDS Archives**: Startup mais rápido

### 🛠️ APIs
- **Math.clamp()**: Limitar valores a um range
- **StringBuilder/StringBuffer repeat()**: Repetir sequências
- **Emoji support**: Melhor suporte a caracteres Unicode

---

## 🎯 Por que Java 21 é Revolucionário?

### 🚀 Virtual Threads mudam tudo:
- **Milhões de threads** simultâneas
- **Código simples** para alta concorrência  
- **Performance excepcional** para I/O
- **Compatível** com código existente

### 🎨 Sintaxe Moderna:
- **String Templates** eliminam concatenação
- **Pattern Matching** torna switch poderoso
- **Record Patterns** simplificam desestruturação

### 🔐 Preparado para o Futuro:
- **Criptografia quantum-safe**
- **APIs modernas e seguras**

---

## 📅 Informações da Versão

- **📅 Lançamento**: Setembro de 2023
- **🔧 Tipo**: LTS (Long Term Support)
- **⚡ Suporte**: Até 2031+
- **🎯 Status**: Nova referência para projetos modernos

---

## 🔗 Links Úteis

- [Oracle Java 21 Documentation](https://docs.oracle.com/en/java/javase/21/)
- [Virtual Threads Tutorial](https://www.baeldung.com/java-virtual-thread-vs-thread)
- [Pattern Matching Guide](https://www.baeldung.com/java-pattern-matching-switch)
- [Migration Guide to Java 21](https://docs.oracle.com/en/java/javase/21/migrate/) 